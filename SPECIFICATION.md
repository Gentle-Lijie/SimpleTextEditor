# SimpleTextEditor - å¤šäººåä½œ Markdown ç¼–è¾‘å™¨åŠŸèƒ½è¯´æ˜æ–‡æ¡£

## 1. é¡¹ç›®æ¦‚è¿°

SimpleTextEditor æ˜¯ä¸€ä¸ªåŸºäº Docker éƒ¨ç½²çš„ç®€çº¦å¤šäººå®æ—¶åä½œå¯Œæ–‡æœ¬ç¼–è¾‘å™¨ã€‚åº•å±‚é‡‡ç”¨ Markdown ä½œä¸ºå­˜å‚¨æ ¼å¼ï¼Œæ”¯æŒæ‰€è§å³æ‰€å¾—ï¼ˆWYSIWYGï¼‰ä¸æºç ç¼–è¾‘ä¸¤ç§æ¨¡å¼ï¼ŒåŠŸèƒ½å¯¹æ ‡ Typoraã€‚

### 1.1 æ ¸å¿ƒç‰¹æ€§

- **Markdown åŸç”Ÿæ”¯æŒ**ï¼šå®Œæ•´æ”¯æŒ GitHub Flavored Markdown (GFM)
- **å®æ—¶åä½œ**ï¼šå¤šäººåŒæ—¶ç¼–è¾‘ï¼Œå®æ—¶åŒæ­¥
- **åŒæ¨¡å¼ç¼–è¾‘**ï¼šæ‰€è§å³æ‰€å¾— + Markdown æºç æ¨¡å¼åˆ‡æ¢
- **ä¸°å¯Œçš„æ‰©å±•**ï¼šæ•°å­¦å…¬å¼ã€Mermaid å›¾è¡¨ã€HTML å†…åµŒ
- **ç®€çº¦å·¥å…·æ **ï¼šå¸¸ç”¨æ ¼å¼åŒ–æ“ä½œä¸€é”®å®Œæˆ

---

## 2. æŠ€æœ¯æ ˆé€‰æ‹©

### 2.1 å‰ç«¯

| ç»„ä»¶ | æŠ€æœ¯é€‰æ‹© | è¯´æ˜ |
|------|----------|------|
| æ¡†æ¶ | Vue 3 + TypeScript | å“åº”å¼ã€ç»„ä»¶åŒ–ã€ç±»å‹å®‰å…¨ |
| æ„å»ºå·¥å…· | Vite | å¿«é€Ÿå¼€å‘ä½“éªŒ |
| Markdown æ¸²æŸ“ | markdown-it | æ’ä»¶ç”Ÿæ€ä¸°å¯Œï¼Œå¯æ‰©å±•æ€§å¼º |
| æ•°å­¦å…¬å¼ | KaTeX | æ¸²æŸ“é€Ÿåº¦å¿«ï¼Œä½“ç§¯å° |
| å›¾è¡¨ | Mermaid | æµç¨‹å›¾ã€æ—¶åºå›¾ç­‰ |
| ä»£ç é«˜äº® | highlight.js | æ”¯æŒ 180+ è¯­è¨€ |
| å®æ—¶åä½œ | Yjs | CRDT ç®—æ³•ï¼Œå†²çªè‡ªåŠ¨è§£å†³ |
| WebSocket | socket.io-client | å®æ—¶é€šä¿¡ |

### 2.2 åç«¯

| ç»„ä»¶ | æŠ€æœ¯é€‰æ‹© | è¯´æ˜ |
|------|----------|------|
| è¿è¡Œæ—¶ | Node.js 20 LTS | ç¨³å®šã€ç”Ÿæ€ä¸°å¯Œ |
| æ¡†æ¶ | Express.js | è½»é‡ã€çµæ´» |
| WebSocket | socket.io | å®æ—¶åŒå‘é€šä¿¡ |
| åä½œå¼•æ“ | y-websocket | Yjs å®˜æ–¹ WebSocket åç«¯ |
| æ•°æ®åº“ | SQLite | è½»é‡çº§ï¼Œé€‚åˆç®€çº¦é¡¹ç›® |
| ORM | better-sqlite3 | åŒæ­¥ APIï¼Œæ€§èƒ½å¥½ |

### 2.3 éƒ¨ç½²

| ç»„ä»¶ | æŠ€æœ¯é€‰æ‹© |
|------|----------|
| å®¹å™¨åŒ– | Docker + Docker Compose |
| åå‘ä»£ç† | Nginx (å¯é€‰) |

---

## 3. åŠŸèƒ½éœ€æ±‚

### 3.1 ç¼–è¾‘å™¨æ ¸å¿ƒåŠŸèƒ½

#### 3.1.1 Markdown æ”¯æŒ (å¯¹æ ‡ Typora)

**åŸºç¡€è¯­æ³• (CommonMark)**
- [ ] æ ‡é¢˜ (H1-H6)
- [ ] ç²—ä½“ã€æ–œä½“ã€åˆ é™¤çº¿
- [ ] æœ‰åº/æ— åºåˆ—è¡¨
- [ ] ä»»åŠ¡åˆ—è¡¨ (Checkbox)
- [ ] å¼•ç”¨å—
- [ ] ä»£ç å— (å¸¦è¯­æ³•é«˜äº®)
- [ ] è¡Œå†…ä»£ç 
- [ ] é“¾æ¥ã€å›¾ç‰‡
- [ ] æ°´å¹³åˆ†å‰²çº¿

**GitHub Flavored Markdown (GFM)**
- [ ] è¡¨æ ¼
- [ ] è‡ªåŠ¨é“¾æ¥
- [ ] è„šæ³¨
- [ ] Emoji çŸ­ä»£ç  (`:smile:` â†’ ğŸ˜„)
- [ ] ä»»åŠ¡åˆ—è¡¨æ‰©å±•

**æ‰©å±•è¯­æ³•**
- [ ] æ•°å­¦å…¬å¼ (KaTeX)
  - è¡Œå†…å…¬å¼: `$E=mc^2$`
  - å—çº§å…¬å¼: `$$\sum_{i=1}^n a_i$$`
- [ ] Mermaid å›¾è¡¨
  - æµç¨‹å›¾ (flowchart)
  - æ—¶åºå›¾ (sequence)
  - ç”˜ç‰¹å›¾ (gantt)
  - ç±»å›¾ (class)
  - çŠ¶æ€å›¾ (state)
  - é¥¼å›¾ (pie)
  - ERå›¾ (er)
- [ ] HTML å†…åµŒ (ç”¨äºè‡ªå®šä¹‰æ ·å¼)
- [ ] ç›®å½•ç”Ÿæˆ (TOC)
- [ ] ä¸Šæ ‡/ä¸‹æ ‡ (`H~2~O`, `X^2^`)
- [ ] é«˜äº®æ ‡è®° (`==highlight==`)
- [ ] ç¼©å†™å®šä¹‰

#### 3.1.2 ç¼–è¾‘æ¨¡å¼

| æ¨¡å¼ | æè¿° |
|------|------|
| æºç æ¨¡å¼ | ç›´æ¥ç¼–è¾‘ Markdown æºç ï¼Œå¸¦è¯­æ³•é«˜äº® |
| é¢„è§ˆæ¨¡å¼ | åªè¯»æ¸²æŸ“é¢„è§ˆ |
| åˆ†å±æ¨¡å¼ | å·¦ä¾§æºç ï¼Œå³ä¾§å®æ—¶é¢„è§ˆ |
| WYSIWYG æ¨¡å¼ | æ‰€è§å³æ‰€å¾—ï¼Œç±»ä¼¼ Typora |

**æ¨¡å¼åˆ‡æ¢å¿«æ·é”®**
- `Ctrl/Cmd + /` : åˆ‡æ¢æºç /WYSIWYG
- `Ctrl/Cmd + Shift + P` : åˆ‡æ¢é¢„è§ˆæ¨¡å¼

### 3.2 å·¥å…·æ åŠŸèƒ½

é¡¶éƒ¨å·¥å…·æ æä¾›å¸¸ç”¨æ ¼å¼åŒ–æ“ä½œï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [B] [I] [S] [U] â”‚ [Hâ–¾] â”‚ [åˆ—è¡¨â–¾] â”‚ [é“¾æ¥] [å›¾ç‰‡] â”‚ [ä»£ç ] â”‚ [é¢œè‰²â–¾] â”‚ [æ›´å¤šâ–¾] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.2.1 æ–‡æœ¬æ ·å¼

| æŒ‰é’® | åŠŸèƒ½ | Markdown/HTML | å¿«æ·é”® |
|------|------|---------------|--------|
| **B** | ç²—ä½“ | `**text**` | Ctrl+B |
| *I* | æ–œä½“ | `*text*` | Ctrl+I |
| ~~S~~ | åˆ é™¤çº¿ | `~~text~~` | Ctrl+Shift+S |
| <u>U</u> | ä¸‹åˆ’çº¿ | `<u>text</u>` | Ctrl+U |
| `code` | è¡Œå†…ä»£ç  | `` `code` `` | Ctrl+` |

#### 3.2.2 æ ‡é¢˜ (ä¸‹æ‹‰èœå•)

- H1 - H6 çº§æ ‡é¢˜
- æ­£æ–‡ (ç§»é™¤æ ‡é¢˜æ ¼å¼)

#### 3.2.3 åˆ—è¡¨ (ä¸‹æ‹‰èœå•)

- æ— åºåˆ—è¡¨ `- item`
- æœ‰åºåˆ—è¡¨ `1. item`
- ä»»åŠ¡åˆ—è¡¨ `- [ ] item`

#### 3.2.4 æ’å…¥åŠŸèƒ½

| æŒ‰é’® | åŠŸèƒ½ | è¯´æ˜ |
|------|------|------|
| é“¾æ¥ | æ’å…¥é“¾æ¥ | å¼¹çª—è¾“å…¥ URL å’Œæ–‡æœ¬ |
| å›¾ç‰‡ | æ’å…¥å›¾ç‰‡ | æ”¯æŒ URL / æœ¬åœ°ä¸Šä¼  |
| ä»£ç  | æ’å…¥ä»£ç å— | å¯é€‰è¯­è¨€ç±»å‹ |
| è¡¨æ ¼ | æ’å…¥è¡¨æ ¼ | å¯è®¾ç½®è¡Œåˆ—æ•° |
| å…¬å¼ | æ’å…¥æ•°å­¦å…¬å¼ | è¡Œå†…/å—çº§ |
| å›¾è¡¨ | æ’å…¥ Mermaid | æ¨¡æ¿é€‰æ‹© |
| å¼•ç”¨ | æ’å…¥å¼•ç”¨å— | `>` |
| åˆ†å‰²çº¿ | æ°´å¹³çº¿ | `---` |

#### 3.2.5 å­—ä½“é¢œè‰² (ä¸‹æ‹‰è°ƒè‰²æ¿)

ä½¿ç”¨ HTML å®ç°è‡ªå®šä¹‰é¢œè‰²ï¼š

```html
<span style="color: #ff0000">çº¢è‰²æ–‡å­—</span>
<span style="background-color: #ffff00">é»„è‰²èƒŒæ™¯</span>
```

**é¢„è®¾é¢œè‰²**
- æ–‡å­—é¢œè‰²ï¼šçº¢ã€æ©™ã€é»„ã€ç»¿ã€è“ã€ç´«ã€é»‘ã€ç°
- èƒŒæ™¯é«˜äº®ï¼šé»„ã€ç»¿ã€è“ã€ç²‰ã€ç°

**è‡ªå®šä¹‰é¢œè‰²**
- æä¾›é¢œè‰²é€‰æ‹©å™¨ (Color Picker)

#### 3.2.6 æ›´å¤šåŠŸèƒ½ (ä¸‹æ‹‰èœå•)

- ç›®å½• (TOC)
- è„šæ³¨
- ä¸Šæ ‡/ä¸‹æ ‡
- æ¸…é™¤æ ¼å¼
- å¯¼å‡º (è§ 3.5)

### 3.3 å®æ—¶åä½œåŠŸèƒ½

#### 3.3.1 å¤šäººç¼–è¾‘

- [ ] å®æ—¶åŒæ­¥ï¼šå¤šç”¨æˆ·åŒæ—¶ç¼–è¾‘ï¼Œè‡ªåŠ¨åˆå¹¶
- [ ] å…‰æ ‡æ˜¾ç¤ºï¼šæ˜¾ç¤ºå…¶ä»–ç”¨æˆ·çš„å…‰æ ‡ä½ç½®å’Œé€‰åŒº
- [ ] ç”¨æˆ·æ ‡è¯†ï¼šä¸åŒç”¨æˆ·ç”¨ä¸åŒé¢œè‰²æ ‡è¯†
- [ ] åœ¨çº¿åˆ—è¡¨ï¼šæ˜¾ç¤ºå½“å‰åœ¨çº¿åä½œè€…

#### 3.3.2 åä½œç»†èŠ‚

| åŠŸèƒ½ | å®ç°æ–¹æ¡ˆ |
|------|----------|
| å†²çªè§£å†³ | CRDT (Yjs) è‡ªåŠ¨åˆå¹¶ |
| å…‰æ ‡åŒæ­¥ | y-protocols awareness |
| æ–­çº¿é‡è¿ | è‡ªåŠ¨é‡è¿ + çŠ¶æ€æ¢å¤ |
| ç¦»çº¿ç¼–è¾‘ | IndexedDB æœ¬åœ°ç¼“å­˜ |

#### 3.3.3 åä½œçŠ¶æ€æŒ‡ç¤º

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸŸ¢ å·²è¿æ¥ â”‚ 3äººåœ¨çº¿: ğŸ‘¤Alice ğŸ‘¤Bob ğŸ‘¤You â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.4 æ–‡æ¡£ç®¡ç†

#### 3.4.1 æ–‡æ¡£æ“ä½œ

- [ ] æ–°å»ºæ–‡æ¡£
- [ ] æ‰“å¼€æ–‡æ¡£ (ä»åˆ—è¡¨é€‰æ‹©)
- [ ] ä¿å­˜æ–‡æ¡£ (è‡ªåŠ¨ä¿å­˜ + æ‰‹åŠ¨ä¿å­˜)
- [ ] é‡å‘½åæ–‡æ¡£
- [ ] åˆ é™¤æ–‡æ¡£
- [ ] æ–‡æ¡£åˆ—è¡¨ / æ–‡ä»¶æ ‘

#### 3.4.2 è‡ªåŠ¨ä¿å­˜

- æ¯ 30 ç§’è‡ªåŠ¨ä¿å­˜
- å¤±å»ç„¦ç‚¹æ—¶è‡ªåŠ¨ä¿å­˜
- æ˜¾ç¤ºä¿å­˜çŠ¶æ€ ("å·²ä¿å­˜" / "ä¿å­˜ä¸­...")

#### 3.4.3 ç‰ˆæœ¬å†å² (å¯é€‰)

- æŸ¥çœ‹å†å²ç‰ˆæœ¬
- æ¢å¤åˆ°æŒ‡å®šç‰ˆæœ¬
- ç‰ˆæœ¬å¯¹æ¯” (diff)

### 3.5 å¯¼å…¥å¯¼å‡º

#### 3.5.1 å¯¼å‡ºæ ¼å¼

| æ ¼å¼ | è¯´æ˜ |
|------|------|
| Markdown (.md) | åŸå§‹ Markdown æ–‡æœ¬ |
| HTML (.html) | æ¸²æŸ“åçš„ HTML (å«æ ·å¼) |
| PDF (.pdf) | é€šè¿‡æµè§ˆå™¨æ‰“å°ç”Ÿæˆ |

#### 3.5.2 å¯¼å…¥æ ¼å¼

| æ ¼å¼ | è¯´æ˜ |
|------|------|
| Markdown (.md) | ç›´æ¥å¯¼å…¥ |
| çº¯æ–‡æœ¬ (.txt) | ä½œä¸ºæ™®é€šæ–‡æœ¬å¯¼å…¥ |

### 3.6 ç”¨æˆ·ä½“éªŒ

#### 3.6.1 å¿«æ·é”®

| å¿«æ·é”® | åŠŸèƒ½ |
|--------|------|
| Ctrl/Cmd + B | ç²—ä½“ |
| Ctrl/Cmd + I | æ–œä½“ |
| Ctrl/Cmd + U | ä¸‹åˆ’çº¿ |
| Ctrl/Cmd + K | æ’å…¥é“¾æ¥ |
| Ctrl/Cmd + S | ä¿å­˜ |
| Ctrl/Cmd + Z | æ’¤é”€ |
| Ctrl/Cmd + Shift + Z | é‡åš |
| Ctrl/Cmd + / | åˆ‡æ¢ç¼–è¾‘æ¨¡å¼ |
| Tab | å¢åŠ ç¼©è¿› |
| Shift + Tab | å‡å°‘ç¼©è¿› |

#### 3.6.2 ä¸»é¢˜

- æµ…è‰²ä¸»é¢˜ (é»˜è®¤)
- æ·±è‰²ä¸»é¢˜
- è·Ÿéšç³»ç»Ÿ

#### 3.6.3 å…¶ä»–

- [ ] å­—æ•°ç»Ÿè®¡
- [ ] é˜…è¯»æ—¶é—´ä¼°ç®—
- [ ] å¤§çº²è§†å›¾ (æ–‡æ¡£ç»“æ„)
- [ ] å…¨å±ç¼–è¾‘ / ä¸“æ³¨æ¨¡å¼
- [ ] æ‹–æ‹½ä¸Šä¼ å›¾ç‰‡
- [ ] ç²˜è´´å›¾ç‰‡è‡ªåŠ¨ä¸Šä¼ 

---

## 4. ç³»ç»Ÿæ¶æ„

### 4.1 æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Docker Compose                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                 â”‚      â”‚           Backend               â”‚  â”‚
â”‚  â”‚    Frontend     â”‚      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚    (Vue 3)      â”‚â—„â”€â”€â”€â”€â–ºâ”‚  â”‚  Express  â”‚ â”‚ y-websocket â”‚  â”‚  â”‚
â”‚  â”‚                 â”‚ WS   â”‚  â”‚  REST API â”‚ â”‚  (Yjsåä½œ)   â”‚  â”‚  â”‚
â”‚  â”‚  - markdown-it  â”‚      â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚  - KaTeX        â”‚      â”‚        â”‚              â”‚         â”‚  â”‚
â”‚  â”‚  - Mermaid      â”‚      â”‚        â–¼              â–¼         â”‚  â”‚
â”‚  â”‚  - Yjs          â”‚      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
â”‚  â”‚                 â”‚      â”‚  â”‚       SQLite            â”‚    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚  â”‚   (æ–‡æ¡£å­˜å‚¨/æŒä¹…åŒ–)      â”‚    â”‚  â”‚
â”‚                           â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
â”‚                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 ç›®å½•ç»“æ„

```
SimpleTextEditor/
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ README.md
â”œâ”€â”€ SPECIFICATION.md
â”‚
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ vite.config.ts
â”‚   â”œâ”€â”€ tsconfig.json
â”‚   â”œâ”€â”€ index.html
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ main.ts
â”‚       â”œâ”€â”€ App.vue
â”‚       â”œâ”€â”€ components/
â”‚       â”‚   â”œâ”€â”€ Editor/
â”‚       â”‚   â”‚   â”œâ”€â”€ Editor.vue          # ä¸»ç¼–è¾‘å™¨ç»„ä»¶
â”‚       â”‚   â”‚   â”œâ”€â”€ SourceEditor.vue    # æºç ç¼–è¾‘å™¨
â”‚       â”‚   â”‚   â”œâ”€â”€ Preview.vue         # é¢„è§ˆç»„ä»¶
â”‚       â”‚   â”‚   â””â”€â”€ WYSIWYG.vue         # æ‰€è§å³æ‰€å¾—ç¼–è¾‘å™¨
â”‚       â”‚   â”œâ”€â”€ Toolbar/
â”‚       â”‚   â”‚   â”œâ”€â”€ Toolbar.vue         # å·¥å…·æ ä¸»ç»„ä»¶
â”‚       â”‚   â”‚   â”œâ”€â”€ FormatButtons.vue   # æ ¼å¼åŒ–æŒ‰é’®
â”‚       â”‚   â”‚   â”œâ”€â”€ ColorPicker.vue     # é¢œè‰²é€‰æ‹©å™¨
â”‚       â”‚   â”‚   â””â”€â”€ InsertMenu.vue      # æ’å…¥èœå•
â”‚       â”‚   â”œâ”€â”€ Sidebar/
â”‚       â”‚   â”‚   â”œâ”€â”€ FileTree.vue        # æ–‡ä»¶æ ‘
â”‚       â”‚   â”‚   â””â”€â”€ Outline.vue         # å¤§çº²è§†å›¾
â”‚       â”‚   â””â”€â”€ Collaboration/
â”‚       â”‚       â”œâ”€â”€ UserList.vue        # åœ¨çº¿ç”¨æˆ·åˆ—è¡¨
â”‚       â”‚       â””â”€â”€ Cursors.vue         # åä½œè€…å…‰æ ‡
â”‚       â”œâ”€â”€ composables/
â”‚       â”‚   â”œâ”€â”€ useMarkdown.ts          # Markdown æ¸²æŸ“
â”‚       â”‚   â”œâ”€â”€ useCollaboration.ts     # åä½œé€»è¾‘
â”‚       â”‚   â”œâ”€â”€ useDocument.ts          # æ–‡æ¡£ç®¡ç†
â”‚       â”‚   â””â”€â”€ useTheme.ts             # ä¸»é¢˜åˆ‡æ¢
â”‚       â”œâ”€â”€ utils/
â”‚       â”‚   â”œâ”€â”€ markdown-it-config.ts   # markdown-it é…ç½®
â”‚       â”‚   â””â”€â”€ shortcuts.ts            # å¿«æ·é”®å¤„ç†
â”‚       â”œâ”€â”€ stores/
â”‚       â”‚   â”œâ”€â”€ editor.ts               # ç¼–è¾‘å™¨çŠ¶æ€
â”‚       â”‚   â””â”€â”€ document.ts             # æ–‡æ¡£çŠ¶æ€
â”‚       â”œâ”€â”€ types/
â”‚       â”‚   â””â”€â”€ index.ts                # TypeScript ç±»å‹
â”‚       â””â”€â”€ styles/
â”‚           â”œâ”€â”€ main.css
â”‚           â”œâ”€â”€ editor.css
â”‚           â””â”€â”€ themes/
â”‚               â”œâ”€â”€ light.css
â”‚               â””â”€â”€ dark.css
â”‚
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ tsconfig.json
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ index.ts                    # å…¥å£
â”‚       â”œâ”€â”€ app.ts                      # Express åº”ç”¨
â”‚       â”œâ”€â”€ websocket.ts                # WebSocket æœåŠ¡
â”‚       â”œâ”€â”€ routes/
â”‚       â”‚   â”œâ”€â”€ documents.ts            # æ–‡æ¡£ CRUD API
â”‚       â”‚   â””â”€â”€ upload.ts               # æ–‡ä»¶ä¸Šä¼ 
â”‚       â”œâ”€â”€ services/
â”‚       â”‚   â”œâ”€â”€ documentService.ts      # æ–‡æ¡£æœåŠ¡
â”‚       â”‚   â””â”€â”€ collaborationService.ts # åä½œæœåŠ¡
â”‚       â”œâ”€â”€ database/
â”‚       â”‚   â”œâ”€â”€ index.ts                # æ•°æ®åº“åˆå§‹åŒ–
â”‚       â”‚   â””â”€â”€ schema.sql              # è¡¨ç»“æ„
â”‚       â””â”€â”€ types/
â”‚           â””â”€â”€ index.ts
â”‚
â””â”€â”€ data/                               # Docker æŒ‚è½½æ•°æ®å·
    â””â”€â”€ sqlite.db
```

---

## 5. API è®¾è®¡

### 5.1 REST API

#### æ–‡æ¡£ç®¡ç†

| æ–¹æ³• | è·¯å¾„ | æè¿° |
|------|------|------|
| GET | `/api/documents` | è·å–æ–‡æ¡£åˆ—è¡¨ |
| GET | `/api/documents/:id` | è·å–å•ä¸ªæ–‡æ¡£ |
| POST | `/api/documents` | åˆ›å»ºæ–°æ–‡æ¡£ |
| PUT | `/api/documents/:id` | æ›´æ–°æ–‡æ¡£ |
| DELETE | `/api/documents/:id` | åˆ é™¤æ–‡æ¡£ |

#### æ–‡ä»¶ä¸Šä¼ 

| æ–¹æ³• | è·¯å¾„ | æè¿° |
|------|------|------|
| POST | `/api/upload/image` | ä¸Šä¼ å›¾ç‰‡ |

#### æ•°æ®ç»“æ„

```typescript
// æ–‡æ¡£
interface Document {
  id: string;
  title: string;
  content: string;        // Markdown å†…å®¹
  createdAt: string;
  updatedAt: string;
}

// API å“åº”
interface ApiResponse<T> {
  success: boolean;
  data?: T;
  error?: string;
}
```

### 5.2 WebSocket äº‹ä»¶

#### åä½œåŒæ­¥ (Yjs)

| äº‹ä»¶ | æ–¹å‘ | æè¿° |
|------|------|------|
| `sync-step-1` | åŒå‘ | åˆå§‹åŒæ­¥ |
| `sync-step-2` | åŒå‘ | åŒæ­¥ç¡®è®¤ |
| `update` | åŒå‘ | å¢é‡æ›´æ–° |
| `awareness-update` | åŒå‘ | ç”¨æˆ·çŠ¶æ€/å…‰æ ‡åŒæ­¥ |

#### æˆ¿é—´ç®¡ç†

| äº‹ä»¶ | æ–¹å‘ | æè¿° |
|------|------|------|
| `join-room` | Clientâ†’Server | åŠ å…¥æ–‡æ¡£æˆ¿é—´ |
| `leave-room` | Clientâ†’Server | ç¦»å¼€æ–‡æ¡£æˆ¿é—´ |
| `user-joined` | Serverâ†’Client | ç”¨æˆ·åŠ å…¥é€šçŸ¥ |
| `user-left` | Serverâ†’Client | ç”¨æˆ·ç¦»å¼€é€šçŸ¥ |

---

## 6. æ•°æ®åº“è®¾è®¡

### 6.1 è¡¨ç»“æ„

```sql
-- æ–‡æ¡£è¡¨
CREATE TABLE documents (
    id TEXT PRIMARY KEY,
    title TEXT NOT NULL DEFAULT 'Untitled',
    content TEXT NOT NULL DEFAULT '',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- Yjs æ–‡æ¡£çŠ¶æ€ (åä½œæŒä¹…åŒ–)
CREATE TABLE yjs_documents (
    doc_id TEXT PRIMARY KEY,
    state BLOB NOT NULL,                -- Yjs æ–‡æ¡£çŠ¶æ€
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (doc_id) REFERENCES documents(id) ON DELETE CASCADE
);

-- æ–‡æ¡£ç‰ˆæœ¬å†å² (å¯é€‰)
CREATE TABLE document_versions (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    doc_id TEXT NOT NULL,
    content TEXT NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (doc_id) REFERENCES documents(id) ON DELETE CASCADE
);
```

---

## 7. Markdown æ¸²æŸ“é…ç½®

### 7.1 markdown-it æ’ä»¶åˆ—è¡¨

```typescript
import MarkdownIt from 'markdown-it';

const md = new MarkdownIt({
  html: true,           // å…è®¸ HTML æ ‡ç­¾
  linkify: true,        // è‡ªåŠ¨è¯†åˆ«é“¾æ¥
  typographer: true,    // æ’ç‰ˆä¼˜åŒ–
  breaks: true,         // æ¢è¡Œç¬¦è½¬ <br>
})
  // GFM æ‰©å±•
  .use(markdownItTaskLists)        // ä»»åŠ¡åˆ—è¡¨
  .use(markdownItFootnote)         // è„šæ³¨
  .use(markdownItEmoji)            // Emoji
  .use(markdownItAnchor)           // æ ‡é¢˜é”šç‚¹
  .use(markdownItToc)              // ç›®å½•ç”Ÿæˆ

  // ä»£ç é«˜äº®
  .use(markdownItHighlight)        // highlight.js é›†æˆ

  // æ•°å­¦å…¬å¼
  .use(markdownItKatex)            // KaTeX é›†æˆ

  // å›¾è¡¨
  .use(markdownItMermaid)          // Mermaid é›†æˆ

  // æ‰©å±•è¯­æ³•
  .use(markdownItSub)              // ä¸‹æ ‡
  .use(markdownItSup)              // ä¸Šæ ‡
  .use(markdownItMark)             // é«˜äº® ==text==
  .use(markdownItAbbr);            // ç¼©å†™
```

### 7.2 KaTeX é…ç½®

```typescript
const katexOptions = {
  throwOnError: false,  // é”™è¯¯æ—¶ä¸æŠ›å¼‚å¸¸
  errorColor: '#cc0000',
  strict: false,
  trust: true,
  macros: {
    // è‡ªå®šä¹‰å®
  }
};
```

### 7.3 Mermaid é…ç½®

```typescript
mermaid.initialize({
  startOnLoad: false,
  theme: 'default',     // 'dark' for dark mode
  securityLevel: 'loose',
  flowchart: {
    useMaxWidth: true,
    htmlLabels: true,
  }
});
```

---

## 8. Docker é…ç½®

### 8.1 docker-compose.yml

```yaml
version: '3.8'

services:
  frontend:
    build: ./frontend
    ports:
      - "3000:80"
    depends_on:
      - backend
    environment:
      - VITE_API_URL=http://localhost:3001
      - VITE_WS_URL=ws://localhost:3001

  backend:
    build: ./backend
    ports:
      - "3001:3001"
    volumes:
      - ./data:/app/data
    environment:
      - NODE_ENV=production
      - DATABASE_PATH=/app/data/sqlite.db
      - PORT=3001
```

### 8.2 Frontend Dockerfile

```dockerfile
# Build stage
FROM node:20-alpine AS builder
WORKDIR /app
COPY package*.json ./
RUN npm ci
COPY . .
RUN npm run build

# Production stage
FROM nginx:alpine
COPY --from=builder /app/dist /usr/share/nginx/html
COPY nginx.conf /etc/nginx/conf.d/default.conf
EXPOSE 80
```

### 8.3 Backend Dockerfile

```dockerfile
FROM node:20-alpine
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production
COPY dist ./dist
EXPOSE 3001
CMD ["node", "dist/index.js"]
```

---

## 9. ç•Œé¢è®¾è®¡

### 9.1 ä¸»ç•Œé¢å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Logo   [æ–°å»º] [æ‰“å¼€]                    [ä¸»é¢˜] [å¯¼å‡ºâ–¾]   ğŸŸ¢ 3äººåœ¨çº¿    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [B] [I] [S] [U] â”‚ [Hâ–¾] â”‚ [åˆ—è¡¨â–¾] â”‚ [é“¾æ¥] [å›¾ç‰‡] [è¡¨æ ¼] â”‚ [é¢œè‰²â–¾] [æ›´å¤š]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        â”‚                                                                â”‚
â”‚  æ–‡ä»¶   â”‚                                                                â”‚
â”‚  åˆ—è¡¨   â”‚                        ç¼–è¾‘åŒºåŸŸ                                â”‚
â”‚        â”‚                                                                â”‚
â”‚ â”€â”€â”€â”€â”€  â”‚         (æºç æ¨¡å¼ / WYSIWYG / åˆ†å±é¢„è§ˆ)                        â”‚
â”‚        â”‚                                                                â”‚
â”‚  å¤§çº²   â”‚                                                                â”‚
â”‚  è§†å›¾   â”‚                                                                â”‚
â”‚        â”‚                                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å­—æ•°: 1,234 â”‚ é˜…è¯»æ—¶é—´: 5åˆ†é’Ÿ â”‚ æœ€åä¿å­˜: åˆšåˆš                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.2 é¢œè‰²é€‰æ‹©å™¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ–‡å­—é¢œè‰²            â”‚
â”‚ â¬› â¬œ ğŸŸ¥ ğŸŸ§ ğŸŸ¨ ğŸŸ© ğŸŸ¦ ğŸŸª â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ èƒŒæ™¯è‰²              â”‚
â”‚ â¬› â¬œ ğŸŸ¥ ğŸŸ§ ğŸŸ¨ ğŸŸ© ğŸŸ¦ ğŸŸª â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [è‡ªå®šä¹‰é¢œè‰²...]      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 10. å®‰å…¨è€ƒè™‘

### 10.1 XSS é˜²æŠ¤

- HTML å†…å®¹ä½¿ç”¨ DOMPurify æ¸…ç†
- ä»…å…è®¸å®‰å…¨çš„ HTML æ ‡ç­¾å’Œå±æ€§
- ç¦æ­¢ `<script>` å’Œäº‹ä»¶å±æ€§

```typescript
import DOMPurify from 'dompurify';

const cleanHtml = DOMPurify.sanitize(html, {
  ALLOWED_TAGS: ['span', 'div', 'p', 'br', 'u', 'mark', ...],
  ALLOWED_ATTR: ['style', 'class'],
  ALLOWED_STYLES: ['color', 'background-color', 'font-size']
});
```

### 10.2 WebSocket å®‰å…¨

- å®ç°è¿æ¥é¢‘ç‡é™åˆ¶
- éªŒè¯æ¶ˆæ¯æ ¼å¼
- æˆ¿é—´æƒé™æ§åˆ¶ (å¯æ‰©å±•)

---

## 11. æ€§èƒ½ä¼˜åŒ–

### 11.1 å‰ç«¯

- [ ] è™šæ‹Ÿæ»šåŠ¨ (é•¿æ–‡æ¡£)
- [ ] é˜²æŠ–æ¸²æŸ“ (è¾“å…¥æ—¶å»¶è¿Ÿæ¸²æŸ“)
- [ ] ä»£ç åˆ†å‰² (æŒ‰éœ€åŠ è½½ Mermaid/KaTeX)
- [ ] Service Worker ç¼“å­˜

### 11.2 åç«¯

- [ ] åä½œçŠ¶æ€å¢é‡åŒæ­¥
- [ ] æ•°æ®åº“è¿æ¥æ± 
- [ ] å‹ç¼©ä¼ è¾“ (gzip)

---

## 12. å¼€å‘è®¡åˆ’å»ºè®®

### Phase 1: åŸºç¡€ç¼–è¾‘å™¨
1. é¡¹ç›®åˆå§‹åŒ– (Vue + Vite + Express)
2. åŸºç¡€ Markdown æ¸²æŸ“ (markdown-it)
3. æºç ç¼–è¾‘å™¨ + é¢„è§ˆ
4. åŸºç¡€å·¥å…·æ 

### Phase 2: æ‰©å±•åŠŸèƒ½
5. KaTeX æ•°å­¦å…¬å¼
6. Mermaid å›¾è¡¨
7. GFM å®Œæ•´æ”¯æŒ
8. é¢œè‰²é€‰æ‹©å™¨ (HTML æ ·å¼)

### Phase 3: å®æ—¶åä½œ
9. Yjs é›†æˆ
10. WebSocket æœåŠ¡
11. å…‰æ ‡åŒæ­¥
12. åœ¨çº¿ç”¨æˆ·æ˜¾ç¤º

### Phase 4: æ–‡æ¡£ç®¡ç†
13. æ–‡æ¡£ CRUD
14. æ–‡ä»¶æ ‘
15. è‡ªåŠ¨ä¿å­˜
16. å¯¼å…¥å¯¼å‡º

### Phase 5: Docker éƒ¨ç½²
17. Dockerfile ç¼–å†™
18. docker-compose é…ç½®
19. ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–

---

## 13. ä¾èµ–æ¸…å•

### Frontend (package.json)

```json
{
  "dependencies": {
    "vue": "^3.4",
    "markdown-it": "^14.0",
    "markdown-it-task-lists": "^2.1",
    "markdown-it-footnote": "^4.0",
    "markdown-it-emoji": "^3.0",
    "markdown-it-anchor": "^8.6",
    "markdown-it-toc-done-right": "^4.2",
    "markdown-it-sub": "^2.0",
    "markdown-it-sup": "^2.0",
    "markdown-it-mark": "^4.0",
    "katex": "^0.16",
    "mermaid": "^10.6",
    "highlight.js": "^11.9",
    "yjs": "^13.6",
    "y-websocket": "^1.5",
    "socket.io-client": "^4.7",
    "dompurify": "^3.0",
    "pinia": "^2.1"
  },
  "devDependencies": {
    "vite": "^5.0",
    "typescript": "^5.3",
    "@vitejs/plugin-vue": "^5.0"
  }
}
```

### Backend (package.json)

```json
{
  "dependencies": {
    "express": "^4.18",
    "socket.io": "^4.7",
    "y-websocket": "^1.5",
    "yjs": "^13.6",
    "better-sqlite3": "^9.2",
    "multer": "^1.4",
    "uuid": "^9.0",
    "cors": "^2.8"
  },
  "devDependencies": {
    "typescript": "^5.3",
    "@types/express": "^4.17",
    "@types/better-sqlite3": "^7.6",
    "tsx": "^4.6"
  }
}
```

---

## 14. å‚è€ƒèµ„æº

- [markdown-it æ–‡æ¡£](https://github.com/markdown-it/markdown-it)
- [KaTeX æ”¯æŒçš„å‡½æ•°](https://katex.org/docs/supported.html)
- [Mermaid è¯­æ³•](https://mermaid.js.org/syntax/flowchart.html)
- [Yjs æ–‡æ¡£](https://docs.yjs.dev/)
- [Typora åŠŸèƒ½å‚è€ƒ](https://typora.io/)
